 AS V1.42 Beta [Bld 223] - Source File main.asm - Page 1 - 12/12/2022 0:6:23


       1/       0 :                         ORG     $0000
       2/       0 :                     
       3/       0 :                         include "vec.asm"
(1)    1/       0 :                         CPU     Z80
(1)    2/       0 :                     
(1)    3/       0 :                         ORG     $0000   ; Reset
(1)    4/       0 : C3 2C 01                jp      reset
(1)    5/       3 :                     
(1)    6/      38 :                         ORG     $0038   ; IRQ
(1)    7/      38 :                      irq:
(1)    8/      38 : C3 38 00                jp      irq
(1)    9/      3B :                         
(1)   10/      66 :                         ORG     $0066   ; NMI
(1)   11/      66 :                      nmi:
(1)   12/      66 : C3 66 00                jp      nmi
(1)   13/      69 :                         
(1)   14/      69 :                         
(1)   15/      69 :                     
       4/      69 :                         include "uart.asm"
(1)    1/      69 :                         CPU     Z80
(1)    2/      69 :                     
(1)    3/      69 : =0H                  PIA_BASE    EQU     $00
(1)    4/      69 : =0H                  PIA_PORTB   EQU     PIA_BASE + $0
(1)    5/      69 : =1H                  PIA_PORTA   EQU     PIA_BASE + $1
(1)    6/      69 : =2H                  PIA_DDRB    EQU     PIA_BASE + $2
(1)    7/      69 : =3H                  PIA_DDRA    EQU     PIA_BASE + $3
(1)    8/      69 : =0BH                 PIA_ACR     EQU     PIA_BASE + $B
(1)    9/      69 : =0CH                 PIA_PCR     EQU     PIA_BASE + $C
(1)   10/      69 :                         
(1)   11/      69 : =0H                  PIA_IN      EQU     $00
(1)   12/      69 : =0FFH                PIA_OUT     EQU     $FF
(1)   13/      69 :                     
(1)   14/      69 : =1H                  FT240_WRMSK EQU     $01     ; WR on bit-0, pulse high to write to the FIFO
(1)   15/      69 : =20H                 FT240_SIWU  EQU     $20     ; SIWU on bit 5, always high
(1)   16/      69 : =0EH                 FT240_NOSTB EQU     $0E     ; RD# = 1, irqs disabled 
(1)   17/      69 : =0CH                 FT240_RDSTB EQU     $0C     ; RD# = 0, irqs disabled (used to read from the FIFO)
(1)   18/      69 : =40H                 FT240_TXE   EQU     $40     ; TXE# on bit 6 (FIFO can accept data when low)
(1)   19/      69 : =80H                 FT240_RXF   EQU     $80     ; RXF# on bit 7 (FIFO has data when low)
(1)   20/      69 :                     
(1)   21/      69 :                     ; Initialize the VIA to operate iwth the FT240, which is use for console IO.
(1)   22/      69 :                     FT240_init:
(1)   23/      69 : 3E 0E                   ld      a,FT240_NOSTB  ; RD# = 1
(1)   24/      6B : D3 0C                   out     PIA_PCR,a
(1)   25/      6D : DB 00                   in      a,PIA_PORTB
(1)   26/      6F : E6 FE                   and     ~FT240_WRMSK   ; WR = 0, don't touch the other bits
(1)   27/      71 : F6 20                   or      FT240_SIWU     ; SIWU = 1, dont' tough the other bits
(1)   28/      73 : D3 00                   out     PIA_PORTB,a
(1)   29/      75 : 3E 00                   ld      a,PIA_IN       ; data port input, its only output when writing to FT240
(1)   30/      77 : D3 03                   out     PIA_DDRA,a
(1)   31/      79 : DB 02                   in      a,PIA_DDRB    ; control ports bits for FT240, don't touch other bits
(1)   32/      7B : F6 21                   or      (FT240_WRMSK | FT240_SIWU) & $FF   ; Ouptut pins
(1)   33/      7D : E6 3F                   and     (~(FT240_RXF | FT240_TXE)) & $FF   ; Input pins
(1)   34/      7F : D3 02                   out     PIA_DDRB,a
(1)   35/      81 :                     
(1)   36/      81 :                     FT240_Flush:
(1)   37/      81 : DB 00                   in      a,PIA_PORTB   ; Test RXF# (bit-7)
(1)   38/      83 : CB 7F                   bit     7,a
(1)   39/      85 : C0                      ret     nz              ; Return when RXF# is set, no data in FIFO
(1)   40/      86 : 3E 0C                   ld      a,FT240_RDSTB  ; FT240 RD# = 0; strobe next byte from FIFO
(1)   41/      88 : D3 0C                   out     PIA_PCR,a
 AS V1.42 Beta [Bld 223] - Source File main.asm(uart.asm) - Page 2 - 12/12/2022 0:6:23


(1)   42/      8A : 00                      nop
(1)   43/      8B : 3E 0E                   ld      a,FT240_NOSTB  ; FT240 RD# = 1
(1)   44/      8D : D3 0C                   out     PIA_PCR,a
(1)   45/      8F : C3 81 00                jp      FT240_Flush
(1)   46/      92 :                     $$NoChar:
(1)   47/      92 : C9                      ret
(1)   48/      93 :                     
(1)   49/      93 :                     ; Output the value in the acc to the console    
(1)   50/      93 :                     PutChar:
(1)   51/      93 : C5                      push    bc
(1)   52/      94 : 0E 00                   ld      c,PIA_PORTB
(1)   53/      96 :                     $$PutCharPoll:
(1)   54/      96 : ED 40                   in      b,(c)           ; Test TXE (bit-6)
(1)   55/      98 : CB 70                   bit     6,b
(1)   56/      9A : C2 96 00                jp      nz,$$PutCharPoll     ; When set the FIFO is full, keep polling until there is room
(1)   57/      9D : D3 01                   out     PIA_PORTA,a   ; Write data to port
(1)   58/      9F : 3E FF                   ld      a,PIA_OUT      ; Set data port direction to output
(1)   59/      A1 : D3 03                   out     PIA_DDRA,a
(1)   60/      A3 : DB 00                   in      a,PIA_PORTB   ; FT240 WR = 1 (don't touch other bits)
(1)   61/      A5 : F6 01                   or      FT240_WRMSK
(1)   62/      A7 : D3 00                   out     PIA_PORTB,a
(1)   63/      A9 : E6 FE                   and     ~FT240_WRMSK   ; FT240 WR = 0
(1)   64/      AB : D3 00                   out     PIA_PORTB,a
(1)   65/      AD : 3E 00                   ld      a,PIA_IN         ; Set data port direction to input
(1)   66/      AF : D3 03                   out     PIA_DDRA,a
(1)   67/      B1 : C1                      pop     bc
(1)   68/      B2 : C9                      ret
(1)   69/      B3 :                     
(1)   70/      B3 :                     ; Read a character from the console in the acc, C == 1 indicates a character was read
(1)   71/      B3 :                     GetChar:
(1)   72/      B3 : C5                      push    bc
(1)   73/      B4 : DB 00                   in      a,PIA_PORTB   ; Test RXF# (bit-7)
(1)   74/      B6 : CB 7F                   bit     7,a
(1)   75/      B8 : C2 CA 00                jp      nz,$$NoChar        ; Branch when RXF# is set, no data in FIFO
(1)   76/      BB : 3E 0C                   ld      a,FT240_RDSTB   ; FT240 RD# = 0; strobe next byte from FIFO
(1)   77/      BD : D3 0C                   out     PIA_PCR,a
(1)   78/      BF : DB 01                   in      a,PIA_PORTA   ; Read data byte from FT240 (assumes DDR in input)
(1)   79/      C1 : 47                      ld      b,a
(1)   80/      C2 : 3E 0E                   ld      a,FT240_NOSTB    ; FT240 RD# = 1
(1)   81/      C4 : D3 0C                   out     PIA_PCR,a
(1)   82/      C6 : 37                      scf                     ; Set carry to indicate we read a data byte
(1)   83/      C7 : 78                      ld      a,b
(1)   84/      C8 : C1                      pop     bc
(1)   85/      C9 : C9                      ret
(1)   86/      CA :                     $$NoChar:
(1)   87/      CA : 37                      scf                     ; CLear carry to indicate there was nothing to read
(1)   88/      CB : 3F                      ccf                     
(1)   89/      CC : C1                      pop     bc
(1)   90/      CD : C9                      ret
(1)   91/      CE :                        
       5/      CE :                         include "LED.asm"
(1)    1/      CE :                         CPU     Z80
(1)    2/      CE :                         
(1)    3/      CE :                     ; PIA already defined in uart.asm
(1)    4/      CE :                     
(1)    5/      CE : =4H                  LED_RED     EQU     $04
(1)    6/      CE : =8H                  LED_GREEN   EQU     $08
(1)    7/      CE : =2H                  LED_BLUE    EQU     $02
(1)    8/      CE :                     
(1)    9/      CE :                     ledon   macro   name,bitName,{GLOBALSYMBOLS}
 AS V1.42 Beta [Bld 223] - Source File main.asm(LED.asm) - Page 3 - 12/12/2022 0:6:23


(1)   10/      CE :                     LED_name_On:
(1)   11/      CE :                         ex      af,af'
(1)   12/      CE :                         in      a,PIA_PORTB
(1)   13/      CE :                         or      LED_RED
(1)   14/      CE :                         out     PIA_PORTB,a
(1)   15/      CE :                         ex      af,af'
(1)   16/      CE :                         ret
(1)   17/      CE :                         endm
(1)   18/      CE :                         
(1)   19/      CE :                     ledoff   macro   name,bitName,{GLOBALSYMBOLS}
(1)   20/      CE :                     LED_name_Off:
(1)   21/      CE :                         ex      af,af'
(1)   22/      CE :                         in      a,PIA_PORTB
(1)   23/      CE :                         and     (~LED_RED) & 255
(1)   24/      CE :                         out     PIA_PORTB,a
(1)   25/      CE :                         ex      af,af'
(1)   26/      CE :                         ret
(1)   27/      CE :                         endm
(1)   28/      CE :                     
(1)   29/      CE :                     ledtoggle   macro   name,bitName,{GLOBALSYMBOLS}
(1)   30/      CE :                     LED_name_Toggle:
(1)   31/      CE :                         ex      af,af'
(1)   32/      CE :                         in      a,PIA_PORTB
(1)   33/      CE :                         xor     LED_RED
(1)   34/      CE :                         out     PIA_PORTB,a
(1)   35/      CE :                         ex      af,af'
(1)   36/      CE :                         ret
(1)   37/      CE :                         endm
(1)   38/      CE :                     
(1)   39/      CE :                     LED_init:
(1)   40/      CE : DB 00                   in      a,PIA_PORTB
(1)   41/      D0 : E6 F1                   and     (~(LED_RED | LED_GREEN | LED_BLUE)) & 255
(1)   42/      D2 : D3 00                   out     PIA_PORTB,a
(1)   43/      D4 : DB 02                   in      a,PIA_DDRB
(1)   44/      D6 : F6 0E                   or      (LED_RED | LED_GREEN | LED_BLUE) & 255
(1)   45/      D8 : D3 02                   out     PIA_DDRB,a
(1)   46/      DA : C9                      ret
(1)   47/      DB :                     
(1)   48/      DB : (MACRO)                  ledon       Red,LED_RED
(1)   48/      DB :                     LED_RED_On:
(1)   48/      DB : 08                      ex      af,af'
(1)   48/      DC : DB 00                   in      a,PIA_PORTB
(1)   48/      DE : F6 04                   or      LED_RED
(1)   48/      E0 : D3 00                   out     PIA_PORTB,a
(1)   48/      E2 : 08                      ex      af,af'
(1)   48/      E3 : C9                      ret
(1)   49/      E4 : (MACRO)                  ledoff      Red,LED_RED
(1)   49/      E4 :                     LED_RED_Off:
(1)   49/      E4 : 08                      ex      af,af'
(1)   49/      E5 : DB 00                   in      a,PIA_PORTB
(1)   49/      E7 : E6 FB                   and     (~LED_RED) & 255
(1)   49/      E9 : D3 00                   out     PIA_PORTB,a
(1)   49/      EB : 08                      ex      af,af'
(1)   49/      EC : C9                      ret
(1)   50/      ED : (MACRO)                  ledtoggle   Red,LED_RED
(1)   50/      ED :                     LED_RED_Toggle:
(1)   50/      ED : 08                      ex      af,af'
(1)   50/      EE : DB 00                   in      a,PIA_PORTB
(1)   50/      F0 : EE 04                   xor     LED_RED
(1)   50/      F2 : D3 00                   out     PIA_PORTB,a
 AS V1.42 Beta [Bld 223] - Source File main.asm(LED.asm) - Page 4 - 12/12/2022 0:6:23


(1)   50/      F4 : 08                      ex      af,af'
(1)   50/      F5 : C9                      ret
(1)   51/      F6 :                         
(1)   52/      F6 : (MACRO)                  ledon       Green,LED_GREEN
(1)   52/      F6 :                     LED_GREEN_On:
(1)   52/      F6 : 08                      ex      af,af'
(1)   52/      F7 : DB 00                   in      a,PIA_PORTB
(1)   52/      F9 : F6 04                   or      LED_RED
(1)   52/      FB : D3 00                   out     PIA_PORTB,a
(1)   52/      FD : 08                      ex      af,af'
(1)   52/      FE : C9                      ret
(1)   53/      FF : (MACRO)                  ledoff      Green,LED_GREEN
(1)   53/      FF :                     LED_GREEN_Off:
(1)   53/      FF : 08                      ex      af,af'
(1)   53/     100 : DB 00                   in      a,PIA_PORTB
(1)   53/     102 : E6 FB                   and     (~LED_RED) & 255
(1)   53/     104 : D3 00                   out     PIA_PORTB,a
(1)   53/     106 : 08                      ex      af,af'
(1)   53/     107 : C9                      ret
(1)   54/     108 : (MACRO)                  ledtoggle   Green,LED_GREEN
(1)   54/     108 :                     LED_GREEN_Toggle:
(1)   54/     108 : 08                      ex      af,af'
(1)   54/     109 : DB 00                   in      a,PIA_PORTB
(1)   54/     10B : EE 04                   xor     LED_RED
(1)   54/     10D : D3 00                   out     PIA_PORTB,a
(1)   54/     10F : 08                      ex      af,af'
(1)   54/     110 : C9                      ret
(1)   55/     111 :                     
(1)   56/     111 : (MACRO)                  ledon       Blue,LED_BLUE
(1)   56/     111 :                     LED_BLUE_On:
(1)   56/     111 : 08                      ex      af,af'
(1)   56/     112 : DB 00                   in      a,PIA_PORTB
(1)   56/     114 : F6 04                   or      LED_RED
(1)   56/     116 : D3 00                   out     PIA_PORTB,a
(1)   56/     118 : 08                      ex      af,af'
(1)   56/     119 : C9                      ret
(1)   57/     11A : (MACRO)                  ledoff      Blue,LED_BLUE
(1)   57/     11A :                     LED_BLUE_Off:
(1)   57/     11A : 08                      ex      af,af'
(1)   57/     11B : DB 00                   in      a,PIA_PORTB
(1)   57/     11D : E6 FB                   and     (~LED_RED) & 255
(1)   57/     11F : D3 00                   out     PIA_PORTB,a
(1)   57/     121 : 08                      ex      af,af'
(1)   57/     122 : C9                      ret
(1)   58/     123 : (MACRO)                  ledtoggle   Blue,LED_BLUE
(1)   58/     123 :                     LED_BLUE_Toggle:
(1)   58/     123 : 08                      ex      af,af'
(1)   58/     124 : DB 00                   in      a,PIA_PORTB
(1)   58/     126 : EE 04                   xor     LED_RED
(1)   58/     128 : D3 00                   out     PIA_PORTB,a
(1)   58/     12A : 08                      ex      af,af'
(1)   58/     12B : C9                      ret
(1)   59/     12C :                     
(1)   60/     12C :                         
(1)   61/     12C :                         
(1)   62/     12C :                     
       6/     12C :                         include "mon.asm"    
(1)    1/     12C :                         CPU     Z80
(1)    2/     12C :                     
(1)    3/     12C :                     ; Simple monitor:
 AS V1.42 Beta [Bld 223] - Source File main.asm(mon.asm) - Page 5 - 12/12/2022 0:6:23


(1)    4/     12C :                     ; Prompt messsage is:
(1)    5/     12C :                     ; 
(1)    6/     12C :                     ; aaaa bb>
(1)    7/     12C :                     ; 
(1)    8/     12C :                     ; Where aaaa is the current addess and bb is the current value at that address.
(1)    9/     12C :                     ;
(1)   10/     12C :                     ; Commands:
(1)   11/     12C :                     ; ?     Show the info message
(1)   12/     12C :                     ; =     Re-read the current address
(1)   13/     12C :                     ; <lf>  Write to current address and increment address
(1)   14/     12C :                     ; +     Increment current address
(1)   15/     12C :                     ; -     Decrement current address
(1)   16/     12C :                     ; g     Go to current address
(1)   17/     12C :                     ; <sp>  Set current address
(1)   18/     12C :                     
(1)   19/     12C :                     ; HL is addrH, addrL
(1)   20/     12C :                     ; DE is userH, userL
(1)   21/     12C :                     
(1)   22/     12C :                     reset:
(1)   23/     12C : ED 56                   im      1               ; Use a known vector for interrups
(1)   24/     12E : 31 FF FF                ld      sp,$FFFF
(1)   25/     131 : CD 69 00                call    FT240_init
(1)   26/     134 : CD CE 00                call    LED_init
(1)   27/     137 :                     
(1)   28/     137 :                     InitMon:
(1)   29/     137 : 21 00 00                ld      hl,$0000
(1)   30/     13A : 11 00 00                ld      de,$0000
(1)   31/     13D :                         
(1)   32/     13D :                     InfoCmd:
(1)   33/     13D : 01 17 02                ld      bc,InfoStr
(1)   34/     140 :                     $$loop:
(1)   35/     140 : 0A                      ld      a,(bc)
(1)   36/     141 : FE 00                   cp      $00
(1)   37/     143 : CA 4E 01                jp      z,Prompt
(1)   38/     146 : CD 93 00                call    PutChar
(1)   39/     149 : 03                      inc     bc
(1)   40/     14A : C3 40 01                jp      $$loop
(1)   41/     14D :                     
(1)   42/     14D : 76                      halt
(1)   43/     14E :                     
(1)   44/     14E :                     Prompt:
(1)   45/     14E : CD E4 00                call    LED_RED_Off
(1)   46/     151 : 3E 0A                   ld      a,$0a           ; Show Prompt
(1)   47/     153 : CD 93 00                call    PutChar
(1)   48/     156 : 7C                      ld      a,h             ; Show high address
(1)   49/     157 : CD E6 01                call    PutHex
(1)   50/     15A : 7D                      ld      a,l             ; Show low address
(1)   51/     15B : CD E6 01                call    PutHex
(1)   52/     15E : 3E 20                   ld      a,' '             ; Space to seperate address and data
(1)   53/     160 : CD 93 00                call    PutChar
(1)   54/     163 : 7E                      ld      a,(hl)
(1)   55/     164 : CD E6 01                call    PutHex
(1)   56/     167 : 3E 3E                   ld      a,'>'            ; Show Prompt
(1)   57/     169 : CD 93 00                call    PutChar
(1)   58/     16C :                      NextChar:   
(1)   59/     16C : CD B3 00                call    GetChar         ; get char from user
(1)   60/     16F : D2 6C 01                jp      nc,NextChar     ; Got a char? Keep polling until we get a char
(1)   61/     172 : CD DB 00                call    LED_RED_On
(1)   62/     175 : 47                      ld      b,a
(1)   63/     176 : CD 93 00                call    PutChar         ; Should we echo the character?????
 AS V1.42 Beta [Bld 223] - Source File main.asm(mon.asm) - Page 6 - 12/12/2022 0:6:23


(1)   64/     179 : 78                      ld      a,b
(1)   65/     17A : FE 3F                   cp      '?'             ; Show info?
(1)   66/     17C : CA 3D 01                jp      z,InfoCmd
(1)   67/     17F : FE 3D                   cp      '='             ; re-read address?
(1)   68/     181 : CA 4E 01                jp      z,Prompt
(1)   69/     184 : FE 0A                   cp      $0a             ; Write data byte?
(1)   70/     186 : C2 8D 01                jp      nz,NotWrite
(1)   71/     189 : 73                      ld      (hl),e          ; Store the last 8-bit value entered at the current address    
(1)   72/     18A : C3 92 01                jp      DoInc           ; Increment the current address
(1)   73/     18D :                     
(1)   74/     18D :                     NotWrite:
(1)   75/     18D : FE 2B                   cp     '+'              ; Incement address?
(1)   76/     18F : C2 96 01                jp      nz,NotInc
(1)   77/     192 :                     DoInc:
(1)   78/     192 : 23                      inc     hl
(1)   79/     193 : C3 4E 01                jp      Prompt
(1)   80/     196 :                     
(1)   81/     196 :                     NotInc:
(1)   82/     196 : FE 2D                   cp      '-'             ; Decrement address?
(1)   83/     198 : C2 9F 01                jp      nz,NotDec
(1)   84/     19B : 2B                      dec     hl
(1)   85/     19C : C3 4E 01                jp      Prompt
(1)   86/     19F :                     
(1)   87/     19F :                     NotDec:
(1)   88/     19F : FE 67                   cp      'g'            ; go to address?
(1)   89/     1A1 : C2 A9 01                jp      nz,NotGo
(1)   90/     1A4 : 01 2C 01                ld      bc,reset
(1)   91/     1A7 : C5                      push    bc
(1)   92/     1A8 : E9                      jp      (hl)
(1)   93/     1A9 :                     
(1)   94/     1A9 :                     NotGo:
(1)   95/     1A9 : FE 20                   cp      ' '            ; set current address?
(1)   96/     1AB : C2 B6 01                jp      NZ,NotAddr
(1)   97/     1AE : 62                      ld      h,d
(1)   98/     1AF : 6B                      ld      l,e
(1)   99/     1B0 : 11 00 00                ld      de,$0000
(1)  100/     1B3 : C3 4E 01                jp      Prompt         ; Continue with the new address 
(1)  101/     1B6 :                     
(1)  102/     1B6 :                     NotAddr:
(1)  103/     1B6 :                     ParseHex:
(1)  104/     1B6 :                         ; Process hex digit [0..9][A..F][a..f]    
(1)  105/     1B6 : E5                      push    hl              ; Save HL and BC 
(1)  106/     1B7 : C5                      push    bc
(1)  107/     1B8 : F6 20                   or      $20             ; Force to lower
(1)  108/     1BA : 21 07 02                ld      hl,HexChars     ; Lookup hex digit in table
(1)  109/     1BD : 01 10 00                ld      bc,16
(1)  110/     1C0 : ED B1                   cpir
(1)  111/     1C2 : CA CA 01                jp      z,GotHex        ; Jump when a hex digit was found
(1)  112/     1C5 : C1                      pop     bc              ; Not a hex digit, restor HL and BC
(1)  113/     1C6 : E1                      pop     hl
(1)  114/     1C7 : C3 4E 01                jp      Prompt          ; Ignore chractervand show prompt
(1)  115/     1CA :                     
(1)  116/     1CA :                     GotHex:
(1)  117/     1CA : CB 23                   sla     e               ; Shift the user value to the left by 4 bits
(1)  118/     1CC : CB 12                   rl      d
(1)  119/     1CE : CB 23                   sla     e
(1)  120/     1D0 : CB 12                   rl      d
(1)  121/     1D2 : CB 23                   sla     e
(1)  122/     1D4 : CB 12                   rl      d
(1)  123/     1D6 : CB 23                   sla     e
 AS V1.42 Beta [Bld 223] - Source File main.asm(mon.asm) - Page 7 - 12/12/2022 0:6:23


(1)  124/     1D8 : CB 12                   rl      d
(1)  125/     1DA : 79                      ld      a,c             ; determin what digit we got
(1)  126/     1DB : 2F                      cpl
(1)  127/     1DC : E6 0F                   and     $0f      
(1)  128/     1DE : B3                      or      e               ; Or it into the user value
(1)  129/     1DF : 5F                      ld      e,a
(1)  130/     1E0 : C1                      pop     bc              ; Restore HL and BC
(1)  131/     1E1 : E1                      pop     hl
(1)  132/     1E2 : 00                      nop
(1)  133/     1E3 : C3 6C 01                jp      NextChar
(1)  134/     1E6 :                         
(1)  135/     1E6 :                     ; Output the value in acc to the console as two hex bytes
(1)  136/     1E6 :                      PutHex:
(1)  137/     1E6 : 47                      ld      b,a                 ; save value for later
(1)  138/     1E7 : CB 3F                   srl     a                   ; move high nibble to low
(1)  139/     1E9 : CB 3F                   srl     a
(1)  140/     1EB : CB 3F                   srl     a
(1)  141/     1ED : CB 3F                   srl     a
(1)  142/     1EF : E5                      push    hl                  ; save for later
(1)  143/     1F0 : 21 07 02                ld      hl,HexChars         ; lookup hex digit              
(1)  144/     1F3 : 85                      add     a,l                 ; (only works when table does not pass page boundary)
(1)  145/     1F4 : 6F                      ld      l,a
(1)  146/     1F5 : 7E                      ld      a,(hl)              
(1)  147/     1F6 : CD 93 00                call    PutChar             ; Send out high digit
(1)  148/     1F9 : 78                      ld      a,b                 ; get value back
(1)  149/     1FA : E6 0F                   and     $0f                 ; mask high nibble away
(1)  150/     1FC : 21 07 02                ld      hl,HexChars         ; lookup hex digit              
(1)  151/     1FF : 85                      add     a,l                 ; (only works when table does not pass page boundary)
(1)  152/     200 : 6F                      ld      l,a
(1)  153/     201 : 7E                      ld      a,(hl)              
(1)  154/     202 : CD 93 00                call    PutChar             ; Send out low digit
(1)  155/     205 : E1                      pop     hl                  ; restore old value
(1)  156/     206 : C9                      ret
(1)  157/     207 :                     
(1)  158/     207 :                     HexChars:
(1)  159/     207 : 30 31 32 33 34 35       db     "0123456789abcdef"
              20D : 36 37 38 39 61 62 
              213 : 63 64 65 66       
(1)  160/     217 :                         
(1)  161/     217 :                     InfoStr:
(1)  162/     217 : 0A 4D 69 6E 69 4D       db     10,"MiniMon,0.1,Z80,0",10,0
              21D : 6F 6E 2C 30 2E 31 
              223 : 2C 5A 38 30 2C 30 
              229 : 0A 00             
(1)  163/     22B :                     
(1)  164/     22B :                         
       7/     22B :                     
 AS V1.42 Beta [Bld 223] - Source File main.asm - Page 8 - 12/12/2022 0:6:23


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                        "i386-unknown-win32" - |
*CASESENSITIVE :                  0 - | *COMPMODE :                       0 - |
*CONSTPI :        3.141592653589793 - | *DATE :                "12/12/2022" - |
 DOINC :                        192 C | *FALSE :                          0 - |
 FT240_FLUSH :                   81 C |  FT240_INIT :                    69 C |
 FT240_NOSTB :                   0E - |  FT240_RDSTB :                   0C - |
 FT240_RXF :                     80 - |  FT240_SIWU :                    20 - |
 FT240_TXE :                     40 - |  FT240_WRMSK :                    1 - |
*FULLPMMU :                       1 - |  GETCHAR :                      0B3 C |
 GOTHEX :                       1CA C | *HAS64 :                          0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
 HEXCHARS :                     207 C |  INFOCMD :                      13D C |
 INFOSTR :                      217 C | *INITMON :                      137 C |
*INSUPMODE :                      0 - |  IRQ :                           38 C |
 LED_BLUE :                       2 - | *LED_BLUE_OFF :                 11A C |
*LED_BLUE_ON :                  111 C | *LED_BLUE_TOGGLE :              123 C |
 LED_GREEN :                      8 - | *LED_GREEN_OFF :                0FF C |
*LED_GREEN_ON :                 0F6 C | *LED_GREEN_TOGGLE :             108 C |
 LED_INIT :                     0CE C |  LED_RED :                        4 - |
 LED_RED_OFF :                  0E4 C |  LED_RED_ON :                   0DB C |
*LED_RED_TOGGLE :               0ED C | *LISTON :                         1 - |
 LOOP45 :                       140 C | *MACEXP :                         7 - |
*MOMCPU :                        80 - | *MOMCPUNAME :                 "Z80" - |
*NESTMAX :                      100 - |  NEXTCHAR :                     16C C |
 NMI :                           66 C | *NOCHAR23 :                      92 C |
 NOCHAR25 :                     0CA C |  NOTADDR :                      1B6 C |
 NOTDEC :                       19F C |  NOTGO :                        1A9 C |
 NOTINC :                       196 C |  NOTWRITE :                     18D C |
*PADDING :                        1 - | *PARSEHEX :                     1B6 C |
*PIA_ACR :                       0B - |  PIA_BASE :                       0 - |
 PIA_DDRA :                       3 - |  PIA_DDRB :                       2 - |
 PIA_IN :                         0 - |  PIA_OUT :                      0FF - |
 PIA_PCR :                       0C - |  PIA_PORTA :                      1 - |
 PIA_PORTB :                      0 - |  PROMPT :                       14E C |
 PUTCHAR :                       93 C |  PUTCHARPOLL24 :                 96 C |
 PUTHEX :                       1E6 C | *RELAXED :                        1 - |
 RESET :                        12C C | *TIME :                    "0:6:23" - |
*TRUE :                           1 - | *VERSION :                     142F - |

     75 symbols
     32 unused symbols

 AS V1.42 Beta [Bld 223] - Source File main.asm - Page 9 - 12/12/2022 0:6:23


  Defined Macros:
  ---------------

LEDOFF                                | LEDON                                
LEDTOGGLE                             |

      3 macros

 AS V1.42 Beta [Bld 223] - Source File main.asm - Page 10 - 12/12/2022 0:6:23


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page
 AS V1.42 Beta [Bld 223] - Source File main.asm - Page 11 - 12/12/2022 0:6:23



  Cross Reference List:
  ---------------------

symbol DOINC (=192, Z:\prj\homebrew\software\mon\Z80\mon.asm:77):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     72    

symbol FT240_FLUSH (=81, Z:\prj\homebrew\software\mon\Z80\uart.asm:36):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     45    

symbol FT240_INIT (=69, Z:\prj\homebrew\software\mon\Z80\uart.asm:22):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     25    

symbol FT240_NOSTB (=0E, Z:\prj\homebrew\software\mon\Z80\uart.asm:16):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     23       43       80    

symbol FT240_RDSTB (=0C, Z:\prj\homebrew\software\mon\Z80\uart.asm:17):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     40       76    

symbol FT240_RXF (=80, Z:\prj\homebrew\software\mon\Z80\uart.asm:19):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     33    

symbol FT240_SIWU (=20, Z:\prj\homebrew\software\mon\Z80\uart.asm:15):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     27       32    

symbol FT240_TXE (=40, Z:\prj\homebrew\software\mon\Z80\uart.asm:18):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     33    

symbol FT240_WRMSK (=1, Z:\prj\homebrew\software\mon\Z80\uart.asm:14):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     26       32       61       63    

symbol GETCHAR (=0B3, Z:\prj\homebrew\software\mon\Z80\uart.asm:71):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     59    

symbol GOTHEX (=1CA, Z:\prj\homebrew\software\mon\Z80\mon.asm:116):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
    111    

symbol HEXCHARS (=207, Z:\prj\homebrew\software\mon\Z80\mon.asm:158):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
    108      143      150    

symbol INFOCMD (=13D, Z:\prj\homebrew\software\mon\Z80\mon.asm:32):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     66    

symbol INFOSTR (=217, Z:\prj\homebrew\software\mon\Z80\mon.asm:161):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     33    

 AS V1.42 Beta [Bld 223] - Source File main.asm - Page 12 - 12/12/2022 0:6:23


symbol IRQ (=38, Z:\prj\homebrew\software\mon\Z80\vec.asm:7):
 file Z:\prj\homebrew\software\mon\Z80\vec.asm :
      8    

symbol LED_BLUE (=2, Z:\prj\homebrew\software\mon\Z80\LED.asm:7):
 file Z:\prj\homebrew\software\mon\Z80\LED.asm :
     41       44    

symbol LED_GREEN (=8, Z:\prj\homebrew\software\mon\Z80\LED.asm:6):
 file Z:\prj\homebrew\software\mon\Z80\LED.asm :
     41       44    

symbol LED_INIT (=0CE, Z:\prj\homebrew\software\mon\Z80\LED.asm:39):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     26    

symbol LED_RED (=4, Z:\prj\homebrew\software\mon\Z80\LED.asm:5):
 file Z:\prj\homebrew\software\mon\Z80\LED.asm :
     41       44       48       49       50       52       53       54    
     56       57       58    

symbol LED_RED_OFF (=0E4, Z:\prj\homebrew\software\mon\Z80\LED.asm:49):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     45    

symbol LED_RED_ON (=0DB, Z:\prj\homebrew\software\mon\Z80\LED.asm:48):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     61    

symbol LOOP45 (=140, Z:\prj\homebrew\software\mon\Z80\mon.asm:34):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     40    

symbol NEXTCHAR (=16C, Z:\prj\homebrew\software\mon\Z80\mon.asm:58):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     60      133    

symbol NMI (=66, Z:\prj\homebrew\software\mon\Z80\vec.asm:11):
 file Z:\prj\homebrew\software\mon\Z80\vec.asm :
     12    

symbol NOCHAR25 (=0CA, Z:\prj\homebrew\software\mon\Z80\uart.asm:86):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     75    

symbol NOTADDR (=1B6, Z:\prj\homebrew\software\mon\Z80\mon.asm:102):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     96    

symbol NOTDEC (=19F, Z:\prj\homebrew\software\mon\Z80\mon.asm:87):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     83    

symbol NOTGO (=1A9, Z:\prj\homebrew\software\mon\Z80\mon.asm:94):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     89    

symbol NOTINC (=196, Z:\prj\homebrew\software\mon\Z80\mon.asm:81):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     76    
 AS V1.42 Beta [Bld 223] - Source File main.asm - Page 13 - 12/12/2022 0:6:23



symbol NOTWRITE (=18D, Z:\prj\homebrew\software\mon\Z80\mon.asm:74):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     70    

symbol PIA_BASE (=0, Z:\prj\homebrew\software\mon\Z80\uart.asm:3):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
      4        5        6        7        8        9    

symbol PIA_DDRA (=3, Z:\prj\homebrew\software\mon\Z80\uart.asm:7):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     30       59       66    

symbol PIA_DDRB (=2, Z:\prj\homebrew\software\mon\Z80\uart.asm:6):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     31       34    
 file Z:\prj\homebrew\software\mon\Z80\LED.asm :
     43       45    

symbol PIA_IN (=0, Z:\prj\homebrew\software\mon\Z80\uart.asm:11):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     29       65    

symbol PIA_OUT (=0FF, Z:\prj\homebrew\software\mon\Z80\uart.asm:12):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     58    

symbol PIA_PCR (=0C, Z:\prj\homebrew\software\mon\Z80\uart.asm:9):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     24       41       44       77       81    

symbol PIA_PORTA (=1, Z:\prj\homebrew\software\mon\Z80\uart.asm:5):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     57       78    

symbol PIA_PORTB (=0, Z:\prj\homebrew\software\mon\Z80\uart.asm:4):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     25       28       37       52       60       62       64       73    
 file Z:\prj\homebrew\software\mon\Z80\LED.asm :
     40       42       48( 2)   49( 2)   50( 2)   52( 2)   53( 2)   54( 2)
     56( 2)   57( 2)   58( 2)

symbol PROMPT (=14E, Z:\prj\homebrew\software\mon\Z80\mon.asm:44):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     37       68       79       85      100      114    

symbol PUTCHAR (=93, Z:\prj\homebrew\software\mon\Z80\uart.asm:50):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     38       47       53       57       63      147      154    

symbol PUTCHARPOLL24 (=96, Z:\prj\homebrew\software\mon\Z80\uart.asm:53):
 file Z:\prj\homebrew\software\mon\Z80\uart.asm :
     56    

symbol PUTHEX (=1E6, Z:\prj\homebrew\software\mon\Z80\mon.asm:136):
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     49       51       55    

symbol RESET (=12C, Z:\prj\homebrew\software\mon\Z80\mon.asm:22):
 file Z:\prj\homebrew\software\mon\Z80\vec.asm :
 AS V1.42 Beta [Bld 223] - Source File main.asm - Page 14 - 12/12/2022 0:6:23


      4    
 file Z:\prj\homebrew\software\mon\Z80\mon.asm :
     90    



0.03 seconds assembly time

    339 lines source file
    402 lines incl. macro expansions
      2 passes
      0 errors
      0 warnings
